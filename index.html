<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üî• Ofertas Imperd√≠veis</title>
    <style>
        :root { 
            --main-color: #6b5fff; 
            --bg-gradient: linear-gradient(135deg, #0a1628 0%, #1a2942 100%); 
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: var(--bg-gradient);
            background-attachment: fixed;
            min-height: 100vh; 
            color: white; 
            padding: 20px; 
        }

        .search-wrapper { 
            position: fixed; 
            top: 20px; 
            left: 20px; 
            z-index: 1000; 
        }
        
        .search-container { 
            background: #1a2942; 
            border-radius: 20px; 
            padding: 10px; 
            transition: all 0.4s ease; 
            border: 2px solid #2d3748; 
            width: 50px; 
            height: 50px;
            overflow: hidden; 
        }
        
        .search-container.active { 
            width: 320px; 
            height: auto; 
        }
        
        .search-main { 
            display: flex; 
            align-items: center; 
            width: 100%; 
        }
        
        .search-btn-trigger { 
            background: none; 
            border: none; 
            font-size: 1.5em; 
            cursor: pointer; 
            padding: 5px;
            flex-shrink: 0;
        }
        
        .search-input { 
            border: none; 
            background: transparent; 
            color: white; 
            padding: 10px; 
            width: 100%; 
            outline: none; 
            display: none;
        }
        
        .search-container.active .search-input { 
            display: block;
        }
        
        .filter-panel { 
            display: none; 
            padding: 15px; 
            border-top: 1px solid #2d3748; 
            margin-top: 10px;
        }
        
        .search-container.active .filter-panel { 
            display: block; 
        }
        
        .filter-group { 
            margin-bottom: 10px; 
        }
        
        .filter-group label { 
            display: block; 
            font-size: 0.75em; 
            color: #a0aec0; 
            margin-bottom: 3px; 
        }
        
        .filter-group select { 
            width: 100%; 
            background: #2d3748; 
            color: white; 
            border: 1px solid #4a5568; 
            padding: 8px; 
            border-radius: 5px; 
            cursor: pointer; 
        }

        .header { 
            text-align: center; 
            margin: 60px 0 30px; 
        }
        
        .header h1 { 
            font-size: 2.5em; 
            color: white; 
            text-shadow: 2px 2px 10px rgba(0,0,0,0.5); 
        }
        
        .products-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); 
            gap: 8px; 
            max-width: 1600px; 
            margin: 0 auto; 
            padding: 0 8px 100px 8px; 
        }
        
        @media (min-width: 768px) {
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
                gap: 15px;
                padding: 0 20px 100px 20px;
            }
        }
        
        @media (min-width: 1024px) {
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
                gap: 20px;
            }
        }

        .product-card { 
            background: rgba(30, 47, 71, 0.9); 
            backdrop-filter: blur(10px); 
            border-radius: 15px; 
            overflow: hidden; 
            position: relative; 
            transition: 0.3s; 
            border: 1px solid #2d3748; 
            display: flex; 
            flex-direction: column; 
        }
        
        .product-card:hover { 
            transform: translateY(-5px); 
            border-color: var(--main-color); 
        }
        
        .media-container { 
            width: 100%; 
            height: 280px; 
            background: #000; 
            position: relative; 
        }
        
        .media-scroller { 
            display: flex; 
            overflow-x: auto; 
            scroll-snap-type: x mandatory; 
            height: 100%; 
            scrollbar-width: none; 
        }
        
        .media-scroller::-webkit-scrollbar { 
            display: none; 
        }
        
        .media-item { 
            flex: 0 0 100%; 
            height: 100%; 
            scroll-snap-align: center; 
        }
        
        .media-item img, 
        .media-item video { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
        }
        
        .product-info { 
            padding: 8px; 
            flex-grow: 1; 
            display: flex; 
            flex-direction: column; 
        }
        
        @media (min-width: 768px) {
            .product-info {
                padding: 12px;
            }
        }
        
        @media (min-width: 1024px) {
            .product-info {
                padding: 15px;
            }
        }
        
        .price { 
            font-size: 1.1em; 
            color: #ff6b35; 
            font-weight: bold; 
            margin-bottom: 8px; 
        }
        
        @media (min-width: 768px) {
            .price {
                font-size: 1.3em;
                margin-bottom: 10px;
            }
        }
        
        @media (min-width: 1024px) {
            .price {
                font-size: 1.4em;
            }
        }
        
        .affiliate-btn { 
            display: block; 
            width: 100%; 
            padding: 8px; 
            background: var(--main-color); 
            color: white; 
            text-decoration: none; 
            text-align: center; 
            border-radius: 6px; 
            font-weight: bold; 
            transition: 0.2s; 
            cursor: pointer; 
            border: none; 
            margin-top: auto;
            font-size: 0.85em;
        }
        
        @media (min-width: 768px) {
            .affiliate-btn {
                padding: 10px;
                border-radius: 8px;
                font-size: 0.9em;
            }
        }
        
        @media (min-width: 1024px) {
            .affiliate-btn {
                padding: 12px;
                font-size: 1em;
            }
        }
        
        .affiliate-btn:hover { 
            filter: brightness(1.2); 
        }

        .platform-badge { 
            position: absolute; 
            top: 10px; 
            right: 10px; 
            padding: 4px 10px; 
            border-radius: 10px; 
            font-size: 0.7em; 
            font-weight: bold; 
            z-index: 5; 
            color: white; 
        }
        
        .shopee { background: #ff4500; } 
        .amazon { background: #ff9900; } 
        .mercadolivre { background: #ffe600; color: #000; }
        .outros { background: #4a5568; }

        .admin-btn { 
            position: fixed; 
            top: 20px; 
            right: 20px; 
            padding: 10px 20px; 
            border-radius: 20px; 
            border: none; 
            cursor: pointer; 
            font-weight: bold; 
            z-index: 1001; 
            background: #2d3748; 
            color: white; 
        }
        
        .admin-btn:hover {
            background: #4a5568;
        }
        
        .cupons-btn {
            position: fixed;
            top: 20px;
            right: 140px;
            padding: 10px 20px;
            border-radius: 20px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            z-index: 1001;
            background: #48bb78;
            color: white;
        }
        
        .cupons-btn:hover {
            background: #38a169;
        }
        
        @media (max-width: 768px) {
            .cupons-btn {
                right: 20px;
                top: 70px;
            }
        }
        
        .modal { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.9); 
            z-index: 2000; 
            overflow-y: auto; 
            padding: 20px; 
        }
        
        .modal-content { 
            background: #1a2942; 
            max-width: 550px; 
            margin: 50px auto; 
            padding: 25px; 
            border-radius: 15px; 
        }
        
        .form-control { 
            width: 100%; 
            padding: 10px; 
            background: #2d3748; 
            border: 1px solid #4a5568; 
            color: white; 
            border-radius: 8px; 
            margin-bottom: 10px; 
            font-family: 'Segoe UI', sans-serif;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--main-color);
        }
        
        .config-box { 
            background: rgba(255,255,255,0.05); 
            padding: 15px; 
            border-radius: 10px; 
            margin-bottom: 15px; 
            border-left: 4px solid var(--main-color); 
        }
        
        .delete-btn {
            position: absolute;
            z-index: 10;
            left: 5px;
            top: 5px;
            background: #e53e3e;
            border: none;
            color: white;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            cursor: pointer;
            font-size: 1.2em;
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        @media (min-width: 768px) {
            .delete-btn {
                left: 8px;
                top: 8px;
                width: 32px;
                height: 32px;
                font-size: 1.4em;
            }
        }
        
        @media (min-width: 1024px) {
            .delete-btn {
                left: 10px;
                top: 10px;
                width: 35px;
                height: 35px;
                font-size: 1.5em;
            }
        }
        
        .delete-btn:hover {
            background: #c53030;
        }
        
        .btn-secondary {
            background: #4a5568;
        }
        
        .btn-secondary:hover {
            background: #2d3748;
        }
        
        .admin-controls {
            display: none;
            text-align: center;
            margin-bottom: 30px;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .admin-controls.active {
            display: flex;
        }
        
        .admin-controls button {
            width: 200px;
            margin: 5px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #a0aec0;
        }

        .empty-state h2 {
            font-size: 3em;
            margin-bottom: 20px;
        }

        textarea.form-control {
            min-height: 80px;
            resize: vertical;
        }

        small {
            color: #a0aec0;
            font-size: 0.85em;
        }

        label {
            display: block;
            margin-top: 10px;
            margin-bottom: 5px;
            color: #e2e8f0;
            font-weight: 500;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loader {
            border: 5px solid #2d3748;
            border-top: 5px solid var(--main-color);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(400px); opacity: 0; }
        }

        .webdav-status {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(30, 47, 71, 0.9);
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 0.85em;
            border: 1px solid #2d3748;
            z-index: 1000;
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-connected { background: #48bb78; }
        .status-disconnected { background: #e53e3e; }
        
        /* P√ÅGINA DE CUPONS */
        .cupons-page {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-gradient);
            z-index: 1500;
            overflow-y: auto;
            padding: 20px;
        }
        
        .cupons-page.active {
            display: block;
        }
        
        .cupons-header {
            text-align: center;
            margin: 80px 0 30px;
        }
        
        .cupons-header h2 {
            font-size: 2em;
            color: white;
            margin-bottom: 10px;
        }
        
        .cupons-close {
            position: fixed;
            top: 20px;
            left: 20px;
            background: #e53e3e;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            z-index: 1501;
        }
        
        .cupons-close:hover {
            background: #c53030;
        }
        
        .cupons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
            padding-bottom: 50px;
        }
        
        .cupom-card {
            background: rgba(30, 47, 71, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid #2d3748;
            transition: 0.3s;
            position: relative;
        }
        
        .cupom-card:hover {
            transform: translateY(-5px);
            border-color: var(--main-color);
            box-shadow: 0 8px 16px rgba(107, 95, 255, 0.3);
        }
        
        .cupom-loja {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .cupom-item {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid var(--main-color);
        }
        
        .cupom-item:last-child {
            margin-bottom: 0;
        }
        
        .cupom-codigo {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .cupom-code {
            background: #2d3748;
            padding: 10px 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 1.1em;
            font-weight: bold;
            color: #4fd1c5;
            flex-grow: 1;
            text-align: center;
            border: 2px dashed #4a5568;
        }
        
        .cupom-copy-btn {
            background: var(--main-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.2s;
        }
        
        .cupom-copy-btn:hover {
            filter: brightness(1.2);
        }
        
        .cupom-desc {
            font-size: 0.9em;
            color: #a0aec0;
            margin-bottom: 10px;
        }
        
        .cupom-link {
            display: block;
            text-align: center;
            background: #48bb78;
            color: white;
            padding: 10px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            transition: 0.2s;
        }
        
        .cupom-link:hover {
            background: #38a169;
        }
        
        .empty-cupons {
            text-align: center;
            padding: 60px 20px;
            color: #a0aec0;
        }

        .help-text {
            background: rgba(66, 153, 225, 0.1);
            border-left: 3px solid #4299e1;
            padding: 12px;
            margin: 15px 0;
            border-radius: 5px;
            font-size: 0.9em;
        }
    </style>
</head>
<body>

    <div class="loading-overlay" id="loadingOverlay">
        <div class="loader"></div>
    </div>

    <div class="search-wrapper">
        <div class="search-container" id="searchContainer">
            <div class="search-main">
                <button class="search-btn-trigger" id="searchToggleBtn">üîç</button>
                <input type="text" class="search-input" id="searchInput" placeholder="Buscar...">
            </div>
            <div class="filter-panel">
                <div class="filter-group">
                    <label>Ordenar por Pre√ßo:</label>
                    <select id="fOrdem">
                        <option value="recent">Mais Recentes</option>
                        <option value="low">Menor Pre√ßo</option>
                        <option value="high">Maior Pre√ßo</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Loja:</label>
                    <select id="fLoja">
                        <option value="all">Todas</option>
                        <option value="shopee">Shopee</option>
                        <option value="amazon">Amazon</option>
                        <option value="mercadolivre">Mercado Livre</option>
                        <option value="outros">Outros</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <button class="admin-btn" id="adminBtn">üîí Admin</button>

    <button class="cupons-btn" id="cuponsBtn">üéüÔ∏è Cupons</button>

    <div class="header">
        <h1 id="siteTitle">üî• Ofertas Imperd√≠veis</h1>
    </div>

    <div class="admin-controls" id="adminControls">
        <button class="affiliate-btn" id="btnNovoProduto">‚ûï Novo Produto</button>
        <button class="affiliate-btn btn-secondary" id="btnGerenciarCupons">üéüÔ∏è Gerenciar Cupons</button>
        <button class="affiliate-btn btn-secondary" id="btnCustomizar">üé® Customizar Site</button>
    </div>

    <div class="products-grid" id="productsGrid">
        <div class="empty-state">
            <h2>üì¶</h2>
            <p>Carregando ofertas...</p>
        </div>
    </div>

    <div class="webdav-status" id="webdavStatus">
        <span class="status-indicator status-disconnected"></span>
        Conectando...
    </div>

    <!-- P√°gina de Cupons -->
    <div class="cupons-page" id="cuponsPage">
        <button class="cupons-close" id="cuponsClose">‚Üê Voltar</button>
        
        <div class="cupons-header">
            <h2>üéüÔ∏è Cupons de Desconto</h2>
            <p style="color: #a0aec0;">Copie o c√≥digo e cole na loja para ganhar desconto!</p>
        </div>
        
        <div class="cupons-grid" id="cuponsGrid">
            <div class="empty-cupons">
                <h2>üéüÔ∏è</h2>
                <p>Nenhum cupom dispon√≠vel no momento.</p>
            </div>
        </div>
    </div>

    <!-- Modal: Primeira Configura√ß√£o WebDAV -->
    <div class="modal" id="firstSetupModal" style="display: none;">
        <div class="modal-content">
            <h3>üöÄ Bem-vindo!</h3>
            <p style="margin: 20px 0;">Configure seu servidor WebDAV para come√ßar a usar o site.</p>
            
            <div class="help-text">
                <strong>üí° Como usar com HTTP (rclone local):</strong><br>
                <strong style="color: #48bb78;">1. Baixe este HTML e abra localmente</strong> (n√£o pelo Netlify/Claude)<br>
                2. Configure o rclone com CORS:<br>
                <code style="background: #000; padding: 8px; border-radius: 3px; display: block; margin-top: 8px; font-size: 0.75em; overflow-x: auto; white-space: pre;">rclone serve webdav drive: --addr :5050 --user miguel --pass 115411 --buffer-size 1g --transfers 64 --checkers 64 --progress --drive-chunk-size 2g --fast-list --dir-cache-time 24h --header "Access-Control-Allow-Origin:*" --header "Access-Control-Allow-Methods:GET,PUT,DELETE,PROPFIND,MKCOL,OPTIONS" --header "Access-Control-Allow-Headers:Authorization,Content-Type,Depth"</code>
                <small style="display: block; margin-top: 8px;">
                ‚ö†Ô∏è <strong>IMPORTANTE:</strong> Sites HTTPS (como Claude.ai/Netlify) n√£o conseguem conectar em servidores HTTP por seguran√ßa do navegador.<br>
                <strong>‚úÖ Solu√ß√£o:</strong> Abra o arquivo HTML direto no navegador (duplo clique) ou use um servidor HTTP local.
                </small>
            </div>
            
            <div class="config-box">
                <label>URL do Servidor WebDAV *</label>
                <input type="text" id="setupWebdavUrl" class="form-control" placeholder="http://192.168.2.103:5050/" value="http://192.168.2.103:5050/">
                <small>Use http:// para servidores locais sem SSL</small>
                
                <label>Usu√°rio *</label>
                <input type="text" id="setupWebdavUser" class="form-control" placeholder="usuario">
                
                <label>Senha *</label>
                <input type="password" id="setupWebdavPass" class="form-control" placeholder="senha">
                
                <div style="margin-top: 15px; padding: 10px; background: rgba(237, 137, 54, 0.1); border-left: 3px solid #ed8936; border-radius: 5px;">
                    <small><strong>‚ö†Ô∏è Importante:</strong> Se o servidor n√£o tiver SSL (HTTPS), o navegador pode bloquear a conex√£o por seguran√ßa. Certifique-se que o servidor WebDAV est√° rodando e acess√≠vel.</small>
                </div>
            </div>
            
            <button class="affiliate-btn" onclick="testAndSaveWebDAV()">üîå Testar Conex√£o</button>
            <button class="affiliate-btn btn-secondary" onclick="skipWebDAV()" style="margin-top: 10px;">‚è≠Ô∏è Pular (Modo Demo)</button>
        </div>
    </div>

    <!-- Modal: Login Admin -->
    <div class="modal" id="loginModal">
        <div class="modal-content" style="max-width: 400px;">
            <h3>üîí Login de Administrador</h3>
            <br>
            <label>Senha:</label>
            <input type="password" id="loginPassword" class="form-control" placeholder="Digite a senha" autocomplete="current-password">
            <small style="display: block; margin-top: 5px; margin-bottom: 15px;">Senha padr√£o: admin123</small>
            
            <button class="affiliate-btn" id="btnFazerLogin">üîì Entrar</button>
            <button class="affiliate-btn btn-secondary" id="btnCancelarLogin">Cancelar</button>
        </div>
    </div>

    <!-- Modal: Produto -->
    <div class="modal" id="prodModal">
        <div class="modal-content">
            <h3>üì¶ Adicionar Oferta</h3>
            <br>
            <label>Cole JSON do Rob√¥ (Opcional):</label>
            <textarea id="jsonPaste" class="form-control" placeholder='{"name":"Produto","price":"99,90","link":"https://..."}'></textarea>
            
            <label>Nome do Produto *</label>
            <input type="text" id="pNome" class="form-control" placeholder="Ex: Fone Bluetooth Premium">
            
            <label>Descri√ß√£o</label>
            <textarea id="pDesc" class="form-control" placeholder="Descri√ß√£o curta do produto..."></textarea>
            
            <label>Pre√ßo *</label>
            <input type="text" id="pPreco" class="form-control" placeholder="Ex: 49,90">
            
            <label>Link de Afiliado *</label>
            <input type="text" id="pLink" class="form-control" placeholder="https://...">
            
            <label>Loja</label>
            <select id="pLoja" class="form-control">
                <option value="shopee">Shopee</option>
                <option value="amazon">Amazon</option>
                <option value="mercadolivre">Mercado Livre</option>
                <option value="outros">Outros</option>
            </select>
            
            <label>Upload de Imagens/V√≠deos:</label>
            <input type="file" id="pFiles" multiple accept="image/*,video/*" class="form-control">
            <small>As imagens ser√£o enviadas para o servidor WebDAV</small>
            
            <label>Ou cole links externos:</label>
            <textarea id="pUrls" class="form-control" placeholder="https://exemplo.com/foto1.jpg
https://exemplo.com/video.mp4"></textarea>
            
            <button class="affiliate-btn" id="btnSalvarProduto" style="margin-top: 20px;">üöÄ Publicar</button>
            <button class="affiliate-btn btn-secondary" id="btnCancelarProduto">Cancelar</button>
        </div>
    </div>

    <!-- Modal: Gerenciar Cupons -->
    <div class="modal" id="cuponsModal">
        <div class="modal-content">
            <h3>üéüÔ∏è Gerenciar Cupons</h3>
            <br>
            
            <div class="config-box">
                <label>Loja:</label>
                <select id="cupomLoja" class="form-control">
                    <option value="shopee">Shopee</option>
                    <option value="aliexpress">AliExpress</option>
                    <option value="amazon">Amazon</option>
                    <option value="mercadolivre">Mercado Livre</option>
                    <option value="outros">Outros</option>
                </select>
                
                <label>C√≥digo do Cupom *</label>
                <input type="text" id="cupomCodigo" class="form-control" placeholder="Ex: DESCONTO10">
                
                <label>Descri√ß√£o do Desconto *</label>
                <input type="text" id="cupomDesc" class="form-control" placeholder="Ex: 10% OFF em eletr√¥nicos">
                
                <label>Link de Afiliado (Opcional)</label>
                <input type="text" id="cupomLink" class="form-control" placeholder="https://...">
            </div>
            
            <button class="affiliate-btn" id="btnAdicionarCupom" style="margin-top: 20px;">‚ûï Adicionar Cupom</button>
            <button class="affiliate-btn btn-secondary" id="btnFecharCuponsModal">Cancelar</button>
            
            <hr style="margin: 30px 0; border-color: #2d3748;">
            
            <h4 style="margin-bottom: 15px;">üìã Cupons Cadastrados:</h4>
            <div id="listaCupons" style="max-height: 300px; overflow-y: auto;">
                <p style="color: #a0aec0; text-align: center;">Nenhum cupom cadastrado ainda.</p>
            </div>
        </div>
    </div>
    <div class="modal" id="configModal">
        <div class="modal-content">
            <h3>üé® Personaliza√ß√£o do Site</h3>
            <br>
            <div class="config-box">
                <label>Cor Principal dos Bot√µes:</label>
                <input type="color" id="cfgColor" class="form-control" style="height:50px; cursor: pointer;">
                
                <label>URL do Papel de Parede:</label>
                <input type="text" id="cfgBg" class="form-control" placeholder="https://exemplo.com/fundo.jpg">
                <small>Cole a URL de uma imagem para usar como fundo</small>
            </div>
            
            <div class="config-box">
                <label>Senha de Administrador:</label>
                <input type="password" id="cfgPassword" class="form-control" placeholder="Digite nova senha">
                <small>Deixe em branco para manter a senha atual</small>
            </div>
            
            <button class="affiliate-btn" id="btnSalvarConfig" style="margin-top: 20px;">üíæ Salvar Configura√ß√µes</button>
            <button class="affiliate-btn btn-secondary" id="btnReconfigurarWebDAV">üåê Reconfigurar WebDAV</button>
            <button class="affiliate-btn btn-secondary" id="btnCancelarConfig">Cancelar</button>
        </div>
    </div>

    <script>
        // ========== WEBDAV CLASS ==========
        class WebDAVClient {
            constructor(url, username, password) {
                this.baseUrl = url.endsWith('/') ? url : url + '/';
                this.username = username;
                this.password = password;
                this.authHeader = 'Basic ' + btoa(username + ':' + password);
            }

            async request(path, method = 'GET', body = null, headers = {}) {
                const url = this.baseUrl + path;
                const options = {
                    method: method,
                    mode: 'cors',
                    credentials: 'omit',
                    headers: {
                        'Authorization': this.authHeader,
                        ...headers
                    }
                };

                if (body) options.body = body;

                console.log('WebDAV Request:', method, url);
                const response = await fetch(url, options);
                console.log('WebDAV Response:', response.status, response.statusText);
                return response;
            }

            async testConnection() {
                try {
                    console.log('Testando conex√£o WebDAV...');
                    
                    // Primeiro tenta sem autentica√ß√£o para ver se o servidor responde
                    const testUrl = this.baseUrl;
                    console.log('URL de teste:', testUrl);
                    
                    const response = await this.request('', 'OPTIONS', null, {});
                    console.log('Teste OPTIONS:', response.status);
                    
                    // Se OPTIONS funcionar, tentar PROPFIND
                    if (response.ok || response.status === 204) {
                        const propfindResponse = await this.request('', 'PROPFIND', null, { 'Depth': '0' });
                        console.log('Teste PROPFIND:', propfindResponse.status);
                        return propfindResponse.ok || propfindResponse.status === 207;
                    }
                    
                    // Alguns servidores n√£o suportam OPTIONS, ent√£o tenta direto com PROPFIND
                    const propfindResponse = await this.request('', 'PROPFIND', null, { 'Depth': '0' });
                    console.log('Teste PROPFIND direto:', propfindResponse.status);
                    return propfindResponse.ok || propfindResponse.status === 207 || propfindResponse.status === 401;
                    
                } catch (e) {
                    console.error('Erro no teste de conex√£o:', e);
                    
                    // Se der erro de CORS, mostrar mensagem espec√≠fica
                    if (e.message.includes('CORS') || e.message.includes('Failed to fetch')) {
                        throw new Error('CORS bloqueado. Configure o rclone com: --header "Access-Control-Allow-Origin:*"');
                    }
                    
                    return false;
                }
            }

            async ensureDirectory(dirPath) {
                try {
                    await this.request(dirPath, 'MKCOL');
                } catch (e) {
                    // Pode j√° existir
                }
            }

            async uploadFile(fileName, content, contentType = 'application/octet-stream') {
                await this.ensureDirectory('ofertas/');
                await this.ensureDirectory('ofertas/images/');
                
                const response = await this.request('ofertas/images/' + fileName, 'PUT', content, {
                    'Content-Type': contentType
                });
                
                if (response.ok || response.status === 201 || response.status === 204) {
                    return this.baseUrl + 'ofertas/images/' + fileName;
                }
                throw new Error('Upload falhou');
            }

            async saveJSON(fileName, data) {
                await this.ensureDirectory('ofertas/');
                const content = JSON.stringify(data, null, 2);
                const response = await this.request('ofertas/' + fileName, 'PUT', content, {
                    'Content-Type': 'application/json'
                });
                return response.ok || response.status === 201 || response.status === 204;
            }

            async loadJSON(fileName) {
                try {
                    const response = await this.request('ofertas/' + fileName, 'GET');
                    if (response.ok) return await response.json();
                    return null;
                } catch (e) {
                    return null;
                }
            }
        }

        // ========== CONFIGURA√á√ÉO FIXA DO WEBDAV ==========
        // IMPORTANTE: Servidor WebDAV j√° configurado
        const WEBDAV_CONFIG_FIXED = {
            enabled: true,  // WebDAV j√° configurado
            url: 'https://guarantee-guards-debian-politicians.trycloudflare.com/',  // URL ATUALIZADA
            username: 'miguel',
            password: '115411'
        };

        // ========== ESTADO GLOBAL ==========
        let webdav = null;
        let webdavConfig = null;
        let webdavConnected = false;
        let allProducts = [];
        let allCupons = [];
        let isAdmin = false;
        let currentConfig = {
            color: '#6b5fff',
            bg: '',
            password: 'admin123'
        };

        // ========== INIT ==========
        async function init() {
            console.log('üöÄ Iniciando...');
            
            // Verificar se tem configura√ß√£o fixa
            if (WEBDAV_CONFIG_FIXED.enabled) {
                console.log('‚úÖ Usando configura√ß√£o WebDAV fixa');
                webdavConfig = {
                    url: WEBDAV_CONFIG_FIXED.url,
                    username: WEBDAV_CONFIG_FIXED.username,
                    password: WEBDAV_CONFIG_FIXED.password
                };
                await connectToWebDAV();
                setupAllEventListeners();
            } else {
                // Modo antigo: pede configura√ß√£o
                loadWebDAVConfigFromLocalStorage();
                
                if (!webdavConfig) {
                    showModal('firstSetupModal');
                    return;
                }
                
                await connectToWebDAV();
                setupAllEventListeners();
            }
        }

        function loadWebDAVConfigFromLocalStorage() {
            try {
                const stored = localStorage.getItem('webdav-config');
                if (stored) {
                    webdavConfig = JSON.parse(stored);
                    console.log('‚úÖ Config WebDAV carregada');
                }
            } catch (e) {
                console.log('‚ùå Erro ao carregar config');
            }
        }

        function saveWebDAVConfigToLocalStorage() {
            localStorage.setItem('webdav-config', JSON.stringify(webdavConfig));
        }

        async function connectToWebDAV() {
            updateStatus('Conectando...', false);
            
            try {
                webdav = new WebDAVClient(
                    webdavConfig.url,
                    webdavConfig.username,
                    webdavConfig.password
                );

                const connected = await webdav.testConnection();
                
                if (connected) {
                    webdavConnected = true;
                    updateStatus('Conectado ‚úì', true);
                    await loadAllData();
                    renderProducts();
                } else {
                    webdavConnected = false;
                    updateStatus('Erro de conex√£o', false);
                    showNotif('‚ùå N√£o foi poss√≠vel conectar ao WebDAV', 'error');
                }
            } catch (e) {
                webdavConnected = false;
                updateStatus('Erro: ' + e.message, false);
                showNotif('‚ùå Erro: ' + e.message, 'error');
            }
        }

        async function loadAllData() {
            showLoading(true);
            
            try {
                const configData = await webdav.loadJSON('config.json');
                if (configData) {
                    currentConfig = configData;
                    applyConfigToUI();
                }

                const productsData = await webdav.loadJSON('products.json');
                if (productsData && Array.isArray(productsData)) {
                    allProducts = productsData;
                } else {
                    allProducts = [];
                }
                
                const cuponsData = await webdav.loadJSON('cupons.json');
                if (cuponsData && Array.isArray(cuponsData)) {
                    allCupons = cuponsData;
                } else {
                    allCupons = [];
                }
            } catch (e) {
                console.log('‚ùå Erro ao carregar dados:', e);
            }
            
            showLoading(false);
        }

        function applyConfigToUI() {
            document.documentElement.style.setProperty('--main-color', currentConfig.color);
            if (currentConfig.bg) {
                document.body.style.backgroundImage = `url('${currentConfig.bg}')`;
            }
        }

        function updateStatus(message, connected) {
            const el = document.getElementById('webdavStatus');
            el.innerHTML = `<span class="status-indicator ${connected ? 'status-connected' : 'status-disconnected'}"></span>${message}`;
        }

        function showLoading(show) {
            document.getElementById('loadingOverlay').classList.toggle('active', show);
        }

        // ========== EVENT LISTENERS ==========
        function setupAllEventListeners() {
            // Busca
            document.getElementById('searchToggleBtn').addEventListener('click', () => {
                document.getElementById('searchContainer').classList.toggle('active');
            });
            document.getElementById('searchInput').addEventListener('input', renderProducts);
            document.getElementById('fOrdem').addEventListener('change', renderProducts);
            document.getElementById('fLoja').addEventListener('change', renderProducts);

            // Admin button - CORRIGIDO
            document.getElementById('adminBtn').addEventListener('click', handleAdminClick);

            // Admin controls
            document.getElementById('btnNovoProduto').addEventListener('click', () => showModal('prodModal'));
            document.getElementById('btnGerenciarCupons').addEventListener('click', () => {
                showModal('cuponsModal');
                renderListaCupons();
            });
            document.getElementById('btnCustomizar').addEventListener('click', () => {
                document.getElementById('cfgColor').value = currentConfig.color;
                document.getElementById('cfgBg').value = currentConfig.bg;
                showModal('configModal');
            });
            
            // Cupons page
            document.getElementById('cuponsBtn').addEventListener('click', abrirCupons);
            document.getElementById('cuponsClose').addEventListener('click', fecharCupons);
            
            // Modal Cupons
            document.getElementById('btnAdicionarCupom').addEventListener('click', adicionarCupom);
            document.getElementById('btnFecharCuponsModal').addEventListener('click', () => hideModal('cuponsModal'));

            // Modal Login
            document.getElementById('btnFazerLogin').addEventListener('click', doLogin);
            document.getElementById('btnCancelarLogin').addEventListener('click', () => hideModal('loginModal'));
            document.getElementById('loginPassword').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') doLogin();
            });

            // Modal Produto
            document.getElementById('btnSalvarProduto').addEventListener('click', saveProduct);
            document.getElementById('btnCancelarProduto').addEventListener('click', () => hideModal('prodModal'));
            document.getElementById('jsonPaste').addEventListener('input', parseJSON);

            // Modal Config
            document.getElementById('btnSalvarConfig').addEventListener('click', saveConfig);
            document.getElementById('btnCancelarConfig').addEventListener('click', () => hideModal('configModal'));
            document.getElementById('btnReconfigurarWebDAV').addEventListener('click', reconfigureWebDAV);
        }

        function handleAdminClick() {
            console.log('üîê Admin button clicado, isAdmin:', isAdmin);
            
            if (isAdmin) {
                // Logout
                isAdmin = false;
                updateAdminUI();
                showNotif('üëã Voc√™ saiu do modo admin', 'info');
            } else {
                // Abrir login
                showModal('loginModal');
                document.getElementById('loginPassword').value = '';
                setTimeout(() => document.getElementById('loginPassword').focus(), 100);
            }
        }

        function doLogin() {
            const pass = document.getElementById('loginPassword').value;
            
            if (!pass) {
                showNotif('‚ö†Ô∏è Digite a senha!', 'warning');
                return;
            }
            
            if (pass === currentConfig.password) {
                isAdmin = true;
                updateAdminUI();
                hideModal('loginModal');
                showNotif('‚úÖ Login realizado!', 'success');
            } else {
                showNotif('‚ùå Senha incorreta!', 'error');
                document.getElementById('loginPassword').value = '';
            }
        }

        function updateAdminUI() {
            const btn = document.getElementById('adminBtn');
            const controls = document.getElementById('adminControls');
            
            if (isAdmin) {
                btn.textContent = 'üîì Sair';
                btn.style.background = '#48bb78';
                controls.classList.add('active');
            } else {
                btn.textContent = 'üîí Admin';
                btn.style.background = '#2d3748';
                controls.classList.remove('active');
            }
            
            renderProducts();
        }

        // ========== MODALS ==========
        function showModal(id) {
            document.getElementById(id).style.display = 'block';
        }

        function hideModal(id) {
            document.getElementById(id).style.display = 'none';
        }

        // ========== WEBDAV SETUP ==========
        async function testAndSaveWebDAV() {
            const url = document.getElementById('setupWebdavUrl').value.trim();
            const user = document.getElementById('setupWebdavUser').value.trim();
            const pass = document.getElementById('setupWebdavPass').value.trim();

            if (!url || !user || !pass) {
                showNotif('‚ö†Ô∏è Preencha todos os campos!', 'warning');
                return;
            }

            showLoading(true);
            updateStatus('Testando conex√£o...', false);

            // Diagn√≥stico completo
            const diagnosticInfo = `
üîç DIAGN√ìSTICO DE CONEX√ÉO:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üìç Origem do Site: ${window.location.protocol}//${window.location.host}
üåê URL WebDAV: ${url}
üë§ Usu√°rio: ${user}
üîê Senha: ${'*'.repeat(pass.length)}
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

Testando conex√£o...
            `.trim();
            
            console.log(diagnosticInfo);

            try {
                console.log('1Ô∏è‚É£ Criando cliente WebDAV...');
                const testClient = new WebDAVClient(url, user, pass);
                
                console.log('2Ô∏è‚É£ Tentando requisi√ß√£o OPTIONS...');
                let testResult = false;
                
                try {
                    const optionsTest = await fetch(url, {
                        method: 'OPTIONS',
                        mode: 'cors',
                        headers: {
                            'Authorization': testClient.authHeader
                        }
                    });
                    console.log('‚úÖ OPTIONS respondeu:', optionsTest.status);
                    testResult = optionsTest.ok || optionsTest.status === 204;
                } catch (optionsError) {
                    console.log('‚ùå OPTIONS falhou:', optionsError.message);
                }

                console.log('3Ô∏è‚É£ Tentando requisi√ß√£o PROPFIND...');
                try {
                    const propfindTest = await fetch(url, {
                        method: 'PROPFIND',
                        mode: 'cors',
                        headers: {
                            'Authorization': testClient.authHeader,
                            'Depth': '0'
                        }
                    });
                    console.log('‚úÖ PROPFIND respondeu:', propfindTest.status);
                    testResult = testResult || propfindTest.ok || propfindTest.status === 207;
                } catch (propfindError) {
                    console.log('‚ùå PROPFIND falhou:', propfindError.message);
                    
                    // Detectar tipo de erro
                    if (propfindError.message.includes('Failed to fetch')) {
                        const protocol = window.location.protocol;
                        const targetProtocol = url.startsWith('https') ? 'https:' : 'http:';
                        
                        if (protocol === 'https:' && targetProtocol === 'http:') {
                            throw new Error('‚ùå MIXED CONTENT BLOQUEADO!\n\n' +
                                'üîí Voc√™ est√° em um site HTTPS tentando conectar em HTTP.\n\n' +
                                '‚úÖ SOLU√á√ÉO:\n' +
                                '1. Salve este HTML localmente\n' +
                                '2. Abra o arquivo direto no navegador (file://)\n' +
                                '3. OU use ngrok/Cloudflare Tunnel para HTTPS\n\n' +
                                'Ou clique em "Pular (Modo Demo)" para testar localmente.');
                        }
                        
                        throw new Error('‚ùå CORS BLOQUEADO!\n\n' +
                            'Seu rclone n√£o est√° permitindo requisi√ß√µes do navegador.\n\n' +
                            '‚úÖ CERTIFIQUE-SE que est√° usando este comando:\n\n' +
                            'rclone serve webdav drive: --addr :5050 --user miguel --pass 115411 \\\n' +
                            '  --header "Access-Control-Allow-Origin:*" \\\n' +
                            '  --header "Access-Control-Allow-Methods:GET,PUT,DELETE,PROPFIND,MKCOL,OPTIONS" \\\n' +
                            '  --header "Access-Control-Allow-Headers:Authorization,Content-Type,Depth" \\\n' +
                            '  --buffer-size 1g --transfers 64 --checkers 64 --progress \\\n' +
                            '  --drive-chunk-size 2g --fast-list --dir-cache-time 24h');
                    }
                }

                if (testResult) {
                    webdavConfig = { url, username: user, password: pass };
                    saveWebDAVConfigToLocalStorage();
                    
                    hideModal('firstSetupModal');
                    showNotif('‚úÖ WebDAV configurado com sucesso!', 'success');
                    
                    await connectToWebDAV();
                    setupAllEventListeners();
                } else {
                    console.error('‚ùå Todas as tentativas falharam');
                    updateStatus('Erro de conex√£o', false);
                    showNotif('‚ùå N√£o foi poss√≠vel conectar.\n\nVerifique o console (F12) para mais detalhes.', 'error');
                }
            } catch (e) {
                console.error('‚ùå Erro capturado:', e);
                updateStatus('Erro: ' + e.message, false);
                
                // Mostrar erro detalhado
                const errorDiv = document.createElement('div');
                errorDiv.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: #1a2942;
                    padding: 30px;
                    border-radius: 15px;
                    max-width: 600px;
                    z-index: 4000;
                    border: 2px solid #e53e3e;
                    white-space: pre-wrap;
                    font-family: monospace;
                    font-size: 0.9em;
                    line-height: 1.6;
                `;
                errorDiv.textContent = e.message;
                
                const closeBtn = document.createElement('button');
                closeBtn.textContent = '‚úñ Fechar';
                closeBtn.className = 'affiliate-btn btn-secondary';
                closeBtn.style.marginTop = '20px';
                closeBtn.onclick = () => errorDiv.remove();
                
                errorDiv.appendChild(closeBtn);
                document.body.appendChild(errorDiv);
            }

            showLoading(false);
        }

        function skipWebDAV() {
            // Modo demo sem WebDAV - usa localStorage
            webdavConfig = { demo: true };
            hideModal('firstSetupModal');
            showNotif('‚ö†Ô∏è Modo Demo - Dados salvos apenas localmente', 'warning');
            updateStatus('Modo Demo (Local)', true);
            setupAllEventListeners();
            loadDemoData();
            renderProducts();
        }

        // ========== CUPONS ==========
        function abrirCupons() {
            document.getElementById('cuponsPage').classList.add('active');
            renderCupons();
        }
        
        function fecharCupons() {
            document.getElementById('cuponsPage').classList.remove('active');
        }
        
        function renderCupons() {
            const grid = document.getElementById('cuponsGrid');
            
            if (allCupons.length === 0) {
                grid.innerHTML = `
                    <div class="empty-cupons">
                        <h2>üéüÔ∏è</h2>
                        <p>Nenhum cupom dispon√≠vel no momento.</p>
                        ${isAdmin ? '<p style="margin-top: 10px;">Fa√ßa login como admin para adicionar cupons!</p>' : ''}
                    </div>
                `;
                return;
            }
            
            // Agrupar cupons por loja
            const cuponsPorLoja = {};
            allCupons.forEach(cupom => {
                if (!cuponsPorLoja[cupom.loja]) {
                    cuponsPorLoja[cupom.loja] = [];
                }
                cuponsPorLoja[cupom.loja].push(cupom);
            });
            
            const lojasIcons = {
                shopee: 'üõçÔ∏è',
                aliexpress: 'üè™',
                amazon: 'üì¶',
                mercadolivre: 'üíõ',
                outros: 'üè¨'
            };
            
            const lojasNomes = {
                shopee: 'Shopee',
                aliexpress: 'AliExpress',
                amazon: 'Amazon',
                mercadolivre: 'Mercado Livre',
                outros: 'Outros'
            };
            
            grid.innerHTML = Object.keys(cuponsPorLoja).map(loja => `
                <div class="cupom-card">
                    <div class="cupom-loja">
                        <span>${lojasIcons[loja] || 'üè¨'}</span>
                        <span>${lojasNomes[loja] || loja}</span>
                    </div>
                    ${cuponsPorLoja[loja].map(cupom => `
                        <div class="cupom-item">
                            <div class="cupom-codigo">
                                <div class="cupom-code">${cupom.codigo}</div>
                                <button class="cupom-copy-btn" onclick="copiarCupom('${cupom.codigo}')">üìã</button>
                            </div>
                            <div class="cupom-desc">${cupom.descricao}</div>
                            ${cupom.link ? `<a href="${cupom.link}" target="_blank" class="cupom-link">üõí Usar Cupom</a>` : ''}
                        </div>
                    `).join('')}
                </div>
            `).join('');
        }
        
        function copiarCupom(codigo) {
            navigator.clipboard.writeText(codigo).then(() => {
                showNotif('‚úÖ Cupom copiado: ' + codigo, 'success');
            }).catch(() => {
                showNotif('‚ùå Erro ao copiar cupom', 'error');
            });
        }
        
        async function adicionarCupom() {
            const loja = document.getElementById('cupomLoja').value;
            const codigo = document.getElementById('cupomCodigo').value.trim();
            const descricao = document.getElementById('cupomDesc').value.trim();
            const link = document.getElementById('cupomLink').value.trim();
            
            if (!codigo || !descricao) {
                showNotif('‚ö†Ô∏è Preencha o c√≥digo e a descri√ß√£o!', 'warning');
                return;
            }
            
            const novoCupom = {
                id: Date.now().toString(),
                loja: loja,
                codigo: codigo.toUpperCase(),
                descricao: descricao,
                link: link,
                createdAt: Date.now()
            };
            
            allCupons.unshift(novoCupom);
            
            showLoading(true);
            try {
                if (webdavConfig && !webdavConfig.demo) {
                    await webdav.saveJSON('cupons.json', allCupons);
                } else {
                    localStorage.setItem('demo-cupons', JSON.stringify(allCupons));
                }
                
                document.getElementById('cupomCodigo').value = '';
                document.getElementById('cupomDesc').value = '';
                document.getElementById('cupomLink').value = '';
                
                showNotif('‚úÖ Cupom adicionado!', 'success');
                renderListaCupons();
            } catch (e) {
                showNotif('‚ùå Erro ao salvar: ' + e.message, 'error');
            }
            showLoading(false);
        }
        
        async function deletarCupom(id) {
            if (!confirm('‚ö†Ô∏è Tem certeza que deseja excluir este cupom?')) return;
            
            showLoading(true);
            try {
                allCupons = allCupons.filter(c => c.id !== id);
                
                if (webdavConfig && !webdavConfig.demo) {
                    await webdav.saveJSON('cupons.json', allCupons);
                } else {
                    localStorage.setItem('demo-cupons', JSON.stringify(allCupons));
                }
                
                showNotif('‚úÖ Cupom exclu√≠do!', 'success');
                renderListaCupons();
            } catch (e) {
                showNotif('‚ùå Erro ao excluir', 'error');
            }
            showLoading(false);
        }
        
        function renderListaCupons() {
            const lista = document.getElementById('listaCupons');
            
            if (allCupons.length === 0) {
                lista.innerHTML = '<p style="color: #a0aec0; text-align: center;">Nenhum cupom cadastrado ainda.</p>';
                return;
            }
            
            lista.innerHTML = allCupons.map(cupom => `
                <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px; margin-bottom: 10px; border-left: 4px solid var(--main-color);">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                        <div>
                            <strong style="color: #4fd1c5; font-size: 1.1em;">${cupom.codigo}</strong>
                            <span style="color: #a0aec0; font-size: 0.85em; margin-left: 10px;">${cupom.loja.toUpperCase()}</span>
                        </div>
                        <button onclick="deletarCupom('${cupom.id}')" style="background: #e53e3e; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 0.9em;">üóëÔ∏è</button>
                    </div>
                    <p style="color: #e2e8f0; font-size: 0.9em; margin-bottom: 5px;">${cupom.descricao}</p>
                    ${cupom.link ? `<a href="${cupom.link}" target="_blank" style="color: #4fd1c5; font-size: 0.85em; text-decoration: none;">üîó ${cupom.link}</a>` : ''}
                </div>
            `).join('');
        }
        
        function loadDemoData() {
            try {
                const stored = localStorage.getItem('demo-products');
                if (stored) {
                    allProducts = JSON.parse(stored);
                }
                
                const storedCupons = localStorage.getItem('demo-cupons');
                if (storedCupons) {
                    allCupons = JSON.parse(storedCupons);
                }
            } catch (e) {
                allProducts = [];
                allCupons = [];
            }
        }

        function saveDemoData() {
            localStorage.setItem('demo-products', JSON.stringify(allProducts));
        }

        function reconfigureWebDAV() {
            hideModal('configModal');
            document.getElementById('setupWebdavUrl').value = webdavConfig.url;
            document.getElementById('setupWebdavUser').value = webdavConfig.username;
            document.getElementById('setupWebdavPass').value = '';
            showModal('firstSetupModal');
        }

        // ========== PRODUCTS ==========
        function parseJSON() {
            try {
                const data = JSON.parse(document.getElementById('jsonPaste').value);
                if (data.name) document.getElementById('pNome').value = data.name;
                if (data.description) document.getElementById('pDesc').value = data.description;
                if (data.price) document.getElementById('pPreco').value = data.price;
                if (data.link) document.getElementById('pLink').value = data.link;
                if (data.images && Array.isArray(data.images)) {
                    document.getElementById('pUrls').value = data.images.join('\n');
                }
            } catch (e) {
                // Ignorar JSON inv√°lido
            }
        }

        async function saveProduct() {
            const nome = document.getElementById('pNome').value.trim();
            const preco = document.getElementById('pPreco').value.trim();
            const link = document.getElementById('pLink').value.trim();

            if (!nome || !preco || !link) {
                showNotif('‚ö†Ô∏è Preencha: Nome, Pre√ßo e Link', 'warning');
                return;
            }

            showLoading(true);

            try {
                const files = document.getElementById('pFiles').files;
                let urls = document.getElementById('pUrls').value.split('\n').map(u => u.trim()).filter(u => u);

                // Upload de arquivos
                for (let file of files) {
                    const fileName = Date.now() + '_' + file.name;
                    const uploadedUrl = await webdav.uploadFile(fileName, file, file.type);
                    urls.push(uploadedUrl);
                }

                if (urls.length === 0) {
                    urls.push('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="400" height="400"%3E%3Crect fill="%232d3748" width="400" height="400"/%3E%3Ctext x="50%25" y="50%25" text-anchor="middle" fill="%23a0aec0" font-size="40" dy=".3em"%3Eüì¶%3C/text%3E%3C/svg%3E');
                }

                const newProduct = {
                    id: Date.now().toString(),
                    name: nome,
                    description: document.getElementById('pDesc').value.trim(),
                    price: preco,
                    link: link,
                    loja: document.getElementById('pLoja').value,
                    medias: urls,
                    createdAt: Date.now()
                };

                allProducts.unshift(newProduct);
                await webdav.saveJSON('products.json', allProducts);

                // Limpar form
                document.getElementById('pNome').value = '';
                document.getElementById('pDesc').value = '';
                document.getElementById('pPreco').value = '';
                document.getElementById('pLink').value = '';
                document.getElementById('pUrls').value = '';
                document.getElementById('jsonPaste').value = '';
                document.getElementById('pFiles').value = '';

                hideModal('prodModal');
                showNotif('‚úÖ Produto adicionado!', 'success');
                renderProducts();
            } catch (e) {
                showNotif('‚ùå Erro: ' + e.message, 'error');
            }

            showLoading(false);
        }

        async function deleteProduct(id) {
            if (!confirm('‚ö†Ô∏è Tem certeza que deseja excluir este produto?')) return;

            showLoading(true);

            try {
                allProducts = allProducts.filter(p => p.id !== id);
                await webdav.saveJSON('products.json', allProducts);
                showNotif('‚úÖ Produto exclu√≠do!', 'success');
                renderProducts();
            } catch (e) {
                showNotif('‚ùå Erro ao excluir', 'error');
            }

            showLoading(false);
        }

        // ========== CONFIG ==========
        async function saveConfig() {
            const newPass = document.getElementById('cfgPassword').value.trim();

            currentConfig.color = document.getElementById('cfgColor').value;
            currentConfig.bg = document.getElementById('cfgBg').value;

            if (newPass) {
                currentConfig.password = newPass;
            }

            showLoading(true);

            try {
                await webdav.saveJSON('config.json', currentConfig);
                showNotif('‚úÖ Configura√ß√µes salvas!', 'success');
                applyConfigToUI();
                hideModal('configModal');
                document.getElementById('cfgPassword').value = '';
            } catch (e) {
                showNotif('‚ùå Erro ao salvar', 'error');
            }

            showLoading(false);
        }

        // ========== RENDER ==========
        function renderProducts() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const loja = document.getElementById('fLoja').value;
            const ordem = document.getElementById('fOrdem').value;

            let filtered = allProducts.filter(p => {
                const nameMatch = (p.name || '').toLowerCase().includes(search) ||
                                 (p.description || '').toLowerCase().includes(search);
                const lojaMatch = (loja === 'all' || p.loja === loja);
                return nameMatch && lojaMatch;
            });

            // Ordena√ß√£o
            filtered.sort((a, b) => {
                if (ordem === 'recent') return b.createdAt - a.createdAt;
                
                const pA = parseFloat((a.price || '0').replace(/[^\d,]/g, '').replace(',', '.')) || 0;
                const pB = parseFloat((b.price || '0').replace(/[^\d,]/g, '').replace(',', '.')) || 0;
                
                if (ordem === 'low') return pA - pB;
                if (ordem === 'high') return pB - pA;
                return 0;
            });

            const grid = document.getElementById('productsGrid');

            if (filtered.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <h2>üîç</h2>
                        <p>Nenhum produto encontrado.</p>
                        ${isAdmin ? '<p style="margin-top: 10px;">Clique em "Novo Produto" para adicionar!</p>' : ''}
                    </div>
                `;
                return;
            }

            grid.innerHTML = filtered.map(p => `
                <div class="product-card">
                    ${isAdmin ? `<button class="delete-btn" onclick="deleteProduct('${p.id}')">√ó</button>` : ''}
                    <span class="platform-badge ${p.loja}">${(p.loja || 'outros').toUpperCase()}</span>
                    <div class="media-container">
                        <div class="media-scroller">
                            ${(p.medias || []).map(m => {
                                const isVideo = m.includes('.mp4') || m.includes('.webm');
                                return `
                                    <div class="media-item">
                                        ${isVideo ? 
                                            `<video src="${m}" muted loop onmouseover="this.play()" onmouseout="this.pause()"></video>` : 
                                            `<img src="${m}" alt="${p.name}" loading="lazy">`
                                        }
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    <div class="product-info">
                        <strong style="font-size: 0.85em; display: block; margin-bottom: 5px; line-height: 1.3; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">${p.name}</strong>
                        ${p.description ? `<p style="font-size:0.75em; color:#a0aec0; margin-bottom: 8px; line-height: 1.3; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; display: none;" class="desc-desktop">${p.description}</p>` : ''}
                        <span class="price">R$ ${p.price}</span>
                        <a href="${p.link}" target="_blank" rel="noopener" class="affiliate-btn">üõí Ver Oferta</a>
                    </div>
                </div>
            `).join('');
            
            // Mostrar descri√ß√£o apenas no desktop
            if (window.innerWidth >= 768) {
                document.querySelectorAll('.desc-desktop').forEach(el => {
                    el.style.display = '-webkit-box';
                });
            }
        }

        // ========== NOTIFICATIONS ==========
        function showNotif(message, type) {
            const colors = {
                success: '#48bb78',
                error: '#e53e3e',
                warning: '#ed8936',
                info: '#4299e1'
            };

            const notif = document.createElement('div');
            notif.textContent = message;
            notif.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                background: ${colors[type] || colors.info};
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                z-index: 3000;
                font-weight: 500;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                animation: slideIn 0.3s ease;
            `;

            document.body.appendChild(notif);

            setTimeout(() => {
                notif.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notif.remove(), 300);
            }, 3000);
        }

        // ========== START ==========
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
